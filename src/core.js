// orb.js
//
// Orb 2.1.0 - Javascript Library for Astronomical Calcrations
//
// Copyright (c) 2017 KASHIWAI, Isana
// Licensed under the MIT license (MIT-LICENSE.txt),

// for Name Space
var Orb = Orb || {};

Orb.Constant = Orb.Constant ||  {
  "PI":Math.PI,
  "RAD":Math.PI/180, //RADIAN
  "AU":149597870.700, //ASTRONOMICAL_UNIT(km)
  "RE": 6378.137, //EARTH_RADIUS(km)
  "LD": 384000, //LUNA_DISTANCE(km)
  "LY": Number("9.46073E+12"), //LIGHT_YEAR(km)
  "PC":Number("3.08568E+13"), //PARSEC(km)
  "G":Number("6.6740831E-11"), //GRAVITATIONAL_CONSTANT
  "GM":2.9591220828559093*Math.pow(10,-4),
  "Planets":["Sun","Mercury","Venus","Earth","Moon","Mars","Jupiter","Saturn","Uranus","Neptune"],
  "Sun":{
    "radius":1392038/2,
    "obliquity":7.25,
    "mass":Number("1.989E+30"),
    "gm":Number("1.327124400189E+11")
  },
  "Mercury":{
    "radius":4879.4/2,
    "obliquity":0.027,
    "mass":Number("3.301E+23"),
    "gm":220329
  },
  "Venus":{
    "radius":12103.6/2,
    "obliquity":177.36,
    "mass":Number("4.867E+24"),
    "gm":3248599
  },
  "Earth":{
    "radius":12756.3/2,
    "obliquity":23.435,
    "mass":Number("5.972E+24"),
    "gm": Number("3.9860044189E+5")
  },
  "Moon":{
    "radius":1737.4,
    "obliquity":1.5424,
    "mass":Number("7.346E+22"),
    "gm":4904.86959
  },
  "Mars":{
    "radius":6794.4/2,
    "obliquity":25,
    "mass":Number("6.417E+24"),
    "gm":42828.9
  },
  "Jupiter":{
    "radius":142984/2,
    "obliquity":3.08,
    "mass":Number("1.899E+27"),
    "gm":1266865349
  },
  "Saturn":{
    "radius":120536/2,
    "obliquity":26.7,
    "mass":Number("5.685E+26"),
    "gm":379311879
  },
  "Uranus":{
    "radius":51118/2,
    "obliquity":97.9,
    "mass":Number("8.682E+26"),
    "gm":57939399
  },
  "Neptune":{
    "radius":49572/2,
    "obliquity":29.6,
    "mass":Number("1.024E+26"),
    "gm":68365299
  }
}
Orb.Const = Orb.Constant

Orb.RoundAngle = Orb.RoundAngle || function(degree){
  var angle = degree%360
  if(angle<0){
    angle = angle+360
  }
  return angle;
}

Orb.NutationAndObliquity  = Orb.NutationAndObliquity || function(date){
  var rad = Orb.Constant.RAD
  //var dt = DeltaT()/86400;
  //var dt = 64/86400;
  var time = new Orb.Time(date)
  var jd = time.jd();// + dt;
  var t = (jd -2451545.0)/36525;
  var omega = (125.04452 - 1934.136261*t+0.0020708*t*t + (t*t+t)/450000)*rad;
  var L0 = (280.4665 + 36000.7698*t)*rad
  var L1 = (218.3165 + 481267.8813*t)*rad
  return {
    nutation:function(){
      var nutation = (-17.20/3600)*Math.sin(omega)-(-1.32/3600)*Math.sin(2*L0)-(0.23/3600)*Math.sin(2*L1)+(0.21/3600)*Math.sin(2*omega)/rad;
      return nutation;
    },
    obliquity:function(){
      var obliquity_zero = 23+26.0/60+21.448/3600 -(46.8150/3600)*t -(0.00059/3600)*t*t +(0.001813/3600)*t*t*t;
      var obliquity_delta = (9.20/3600)*Math.cos(omega) + (0.57/3600)*Math.cos(2*L0) +(0.10/3600)*Math.cos(2*L1)-(0.09/3600)*Math.cos(2*omega);
      var obliquity= obliquity_zero + obliquity_delta;
      return obliquity;
    }
  }
}

Orb.Obliquity  = Orb.Obliquity || function(date){
 var ob = new Orb.NutationAndObliquity(date)
 return ob.obliquity()
}

Orb.Earth = function(){}
Orb.Earth.prototype = {
  xyz: function(date){
    var time = new Orb.Time(date)
    var jd = time.jd();
    var t = ((jd -2451545.0)/365250);
    var v = [0,0,0];
    var target_data = Orb.Terms.Earth;
    for(var i=0,ln = target_data.length; i<ln; i++){
      var tmp_data = target_data[i];
      var n = tmp_data[0];
      var sum = Math.pow(t,Number(tmp_data[1]))*Number(tmp_data[2]) * Math.cos(Number(tmp_data[3]) + Number(tmp_data[4]) * t);
      v[n] = v[n]  + sum;
    }
    return {
      x:v[0],
      y:v[1],
      z:v[2],
      "date":date,
      "coordinate_keywords":"ecliptic rectangular",
      "unit_keywords":"au"
    }
  },
  radec:function(date){
    return {
      "ra":0,
      "dec":0,
      "distance":0,
      "date":date,
      "coordinate_keywords":"equatorial spherical",
      "unit_keywords":"hours degree"
    }
  }
}
Orb.Terms = Orb.Terms || {};
Orb.Terms.Earth=[
  [0,0,0.99982928844,1.75348568475,6283.07584999140],
  [0,0,0.00835257300,1.71034539450,12566.15169998280],
  [0,0,0.00561144206,0.00000000000,0.00000000000],
  [0,0,0.00010466628,1.66722645223,18849.22754997420],
  [0,0,0.00003110838,0.66875185215,83996.84731811189],
  [0,0,0.00002552498,0.58310207301,529.69096509460],
  [0,0,0.00002137256,1.09235189672,1577.34354244780],
  [0,0,0.00001709103,0.49540223397,6279.55273164240],
  [0,0,0.00001707882,6.15315547484,6286.59896834040],
  [0,0,0.00001445242,3.47272783760,2352.86615377180],
  [0,0,0.00001091006,3.68984782465,5223.69391980220],
  [0,0,0.00000934429,6.07389922585,12036.46073488820],
  [0,0,0.00000899144,3.17571950523,10213.28554621100],
  [0,0,0.00000566514,2.15262034016,1059.38193018920],
  [0,0,0.00000684416,1.30699021227,5753.38488489680],
  [0,0,0.00000734455,4.35500196530,398.14900340820],
  [0,0,0.00000681437,2.21821534685,4705.73230754360],
  [0,0,0.00000611238,5.38479234323,6812.76681508600],
  [0,0,0.00000451836,6.08768280868,5884.92684658320],
  [0,0,0.00000451953,1.27933728354,6256.77753019160],
  [0,0,0.00000449517,5.36923831714,6309.37416979120],
  [0,0,0.00000406248,0.54361367084,6681.22485339960],
  [0,0,0.00000540957,0.78677364655,775.52261132400],
  [0,0,0.00000547004,1.46146650376,14143.49524243060],
  [0,0,0.00000520484,4.43295799975,7860.41939243920],
  [0,0,0.00000214960,4.50213844573,11506.76976979360],
  [0,0,0.00000227892,1.23941482802,7058.59846131540],
  [0,0,0.00000225878,3.27244306207,4694.00295470760],
  [0,0,0.00000255820,2.26556277246,12168.00269657460],
  [0,0,0.00000256182,1.45474116190,709.93304855830],
  [0,0,0.00000178120,2.96205424204,796.29800681640],
  [0,0,0.00000161205,1.47337718956,5486.77784317500],
  [0,0,0.00000178325,6.24374704602,6283.14316029419],
  [0,0,0.00000178325,0.40466470869,6283.00853968860],
  [0,0,0.00000155487,1.62409309523,25132.30339996560],
  [0,0,0.00000209024,5.85207528073,11790.62908865880],
  [0,0,0.00000199971,4.07209938245,17789.84561978500],
  [0,0,0.00000128933,5.21693314150,7079.37385680780],
  [0,0,0.00000128099,4.80182882228,3738.76143010800],
  [0,0,0.00000151691,0.86921639327,213.29909543800],
  [0,1,0.00123403056,0.00000000000,0.00000000000],
  [0,1,0.00051500156,6.00266267204,12566.15169998280],
  [0,1,0.00001290726,5.95943124583,18849.22754997420],
  [0,1,0.00001068627,2.01554176551,6283.07584999140],
  [0,1,0.00000212689,1.73380190491,6279.55273164240],
  [0,1,0.00000212515,4.91489371033,6286.59896834040],
  [0,1,0.00000062260,0.36239798178,4705.73230754360],
  [0,1,0.00000059822,3.81195369871,6256.77753019160],
  [0,1,0.00000059514,2.83634160150,6309.37416979120],
  [0,1,0.00000048841,5.21419389335,775.52261132400],
  [0,1,0.00000042883,0.43789776559,1059.38193018920],
  [0,1,0.00000046286,0.01839494103,7860.41939243920],
  [0,1,0.00000035675,1.45279327264,5884.92684658320],
  [0,1,0.00000036061,2.16002201071,5753.38488489680],
  [0,1,0.00000035367,4.47243820095,6812.76681508600],
  [0,1,0.00000032137,5.19589851893,6681.22485339960],
  [0,1,0.00000028763,5.91618989512,25132.30339996560],
  [0,1,0.00000028447,1.14976253807,6127.65545055720],
  [0,1,0.00000027573,5.50119104683,6438.49624942560],
  [0,1,0.00000024815,2.92204909812,5486.77784317500],
  [0,1,0.00000020611,3.71790880968,7079.37385680780],
  [0,1,0.00000019565,2.89351924469,5507.55323866740],
  [0,1,0.00000018308,1.46954314992,11790.62908865880],
  [0,1,0.00000016471,6.22682639292,11506.76976979360],
  [0,1,0.00000016757,3.81935015812,7058.59846131540],
  [0,1,0.00000014555,5.97554823531,6290.18939699220],
  [0,1,0.00000014388,0.68157599309,6275.96230299060],
  [0,1,0.00000013921,1.44156172409,796.29800681640],
  [0,1,0.00000011845,4.15246503623,4694.00295470760],
  [0,1,0.00000012573,0.30429978572,7.11354700080],
  [0,1,0.00000010073,3.28940171828,3738.76143010800],
  [0,1,0.00000010425,4.26610810148,6282.09552892320],
  [0,1,0.00000010425,2.38242547117,6284.05617105960],
  [0,2,0.00004143217,3.14159265359,0.00000000000],
  [0,2,0.00002175695,4.39999849572,12566.15169998280],
  [0,2,0.00000995233,0.20790847155,6283.07584999140],
  [0,2,0.00000092659,4.19285471010,18849.22754997420],
  [0,2,0.00000013679,3.37833642063,6286.59896834040],
  [0,2,0.00000013668,3.27271492019,6279.55273164240],
  [0,3,0.00000175213,3.14159265359,0.00000000000],
  [0,3,0.00000072337,2.89303952476,12566.15169998280],
  [0,3,0.00000008364,3.85500954096,6283.07584999140],
  [0,3,0.00000005040,2.53152989786,18849.22754997420],
  [0,3,0.00000001481,2.23672235234,6438.49624942560],
  [0,3,0.00000001481,4.41181122031,6127.65545055720],
  [0,4,0.00000004022,0.00000000000,0.00000000000],
  [0,4,0.00000001927,1.18746233453,12566.15169998280],
  [1,0,0.99989211030,0.18265890456,6283.07584999140],
  [1,0,0.02442699036,3.14159265359,0.00000000000],
  [1,0,0.00835292314,0.13952878991,12566.15169998280],
  [1,0,0.00010466965,0.09641690558,18849.22754997420],
  [1,0,0.00003110838,5.38114091484,83996.84731811189],
  [1,0,0.00002570338,5.30103973360,529.69096509460],
  [1,0,0.00002147473,2.66253538905,1577.34354244780],
  [1,0,0.00001709219,5.20780401071,6279.55273164240],
  [1,0,0.00001707987,4.58232858766,6286.59896834040],
  [1,0,0.00001440265,1.90068164664,2352.86615377180],
  [1,0,0.00001135092,5.27313415220,5223.69391980220],
  [1,0,0.00000934539,4.50301201844,12036.46073488820],
  [1,0,0.00000900565,1.60563288120,10213.28554621100],
  [1,0,0.00000567126,0.58142248753,1059.38193018920],
  [1,0,0.00000744932,2.80728871886,398.14900340820],
  [1,0,0.00000639316,6.02923915017,5753.38488489680],
  [1,0,0.00000681324,0.64729627497,4705.73230754360],
  [1,0,0.00000611347,3.81381495286,6812.76681508600],
  [1,0,0.00000450435,4.52785572489,5884.92684658320],
  [1,0,0.00000452018,5.99167242707,6256.77753019160],
  [1,0,0.00000449968,3.79880375595,6309.37416979120],
  [1,0,0.00000551390,3.96125249369,5507.55323866740],
  [1,0,0.00000406334,5.25616268027,6681.22485339960],
  [1,0,0.00000541273,5.49902805917,775.52261132400],
  [1,0,0.00000546360,6.17311131785,14143.49524243060],
  [1,0,0.00000507084,2.87025193381,7860.41939243920],
  [1,0,0.00000219504,2.95216139568,11506.76976979360],
  [1,0,0.00000227937,5.95179248814,7058.59846131540],
  [1,0,0.00000227792,4.84547074733,4694.00295470760],
  [1,0,0.00000255845,0.69454231563,12168.00269657460],
  [1,0,0.00000256132,6.16722512388,709.93304855830],
  [1,0,0.00000179242,1.40003446021,796.29800681640],
  [1,0,0.00000178280,5.11717552231,6283.00853968860],
  [1,0,0.00000178280,4.67307255246,6283.14316029419],
  [1,0,0.00000155454,0.05340525434,25132.30339996560],
  [1,0,0.00000206257,4.28366728882,11790.62908865880],
  [1,0,0.00000149769,6.07429023278,5486.77784317500],
  [1,0,0.00000200005,2.50144088120,17789.84561978500],
  [1,0,0.00000129006,3.64623708634,7079.37385680780],
  [1,0,0.00000128211,3.23254821381,3738.76143010800],
  [1,0,0.00000152790,5.58120800450,213.29909543800],
  [1,0,0.00000118725,5.45361490488,9437.76293488700],
  [1,1,0.00093046324,0.00000000000,0.00000000000],
  [1,1,0.00051506609,4.43180499286,12566.15169998280],
  [1,1,0.00001290800,4.38860548540,18849.22754997420],
  [1,1,0.00000464550,5.82729912952,6283.07584999140],
  [1,1,0.00000212689,0.16300556918,6279.55273164240],
  [1,1,0.00000212533,3.34400595407,6286.59896834040],
  [1,1,0.00000062345,5.07377354827,4705.73230754360],
  [1,1,0.00000059794,2.24100907272,6256.77753019160],
  [1,1,0.00000059441,1.26619990626,6309.37416979120],
  [1,1,0.00000048987,3.64166577835,775.52261132400],
  [1,1,0.00000042746,5.15177425824,1059.38193018920],
  [1,1,0.00000046642,4.71575215800,7860.41939243920],
  [1,1,0.00000037274,0.66041323804,5753.38488489680],
  [1,1,0.00000035625,6.15462846966,5884.92684658320],
  [1,1,0.00000035373,2.90052012152,6812.76681508600],
  [1,1,0.00000032157,3.62669702015,6681.22485339960],
  [1,1,0.00000028763,4.34539355621,25132.30339996560],
  [1,1,0.00000028447,5.86215103214,6127.65545055720],
  [1,1,0.00000027502,3.92641632542,6438.49624942560],
  [1,1,0.00000024830,1.35190115953,5486.77784317500],
  [1,1,0.00000020618,2.14772396647,7079.37385680780],
  [1,1,0.00000019531,1.29958310594,5507.55323866740],
  [1,1,0.00000018447,6.17330532651,11790.62908865880],
  [1,1,0.00000016520,4.63328039489,11506.76976979360],
  [1,1,0.00000016754,2.24862220282,7058.59846131540],
  [1,1,0.00000014560,4.40425761361,6290.18939699220],
  [1,1,0.00000014426,5.39226330857,6275.96230299060],
  [1,1,0.00000014186,6.18547219419,796.29800681640],
  [1,1,0.00000012666,5.73231393752,4694.00295470760],
  [1,1,0.00000012966,5.10338935824,7.11354700080],
  [1,1,0.00000010100,1.72464513593,3738.76143010800],
  [1,1,0.00000010425,2.69531177468,6282.09552892320],
  [1,1,0.00000010425,0.81162914438,6284.05617105960],
  [1,2,0.00005080208,0.00000000000,0.00000000000],
  [1,2,0.00002178016,2.82957544235,12566.15169998280],
  [1,2,0.00001020487,4.63746718598,6283.07584999140],
  [1,2,0.00000092688,2.62218748420,18849.22754997420],
  [1,2,0.00000013680,1.80736896884,6286.59896834040],
  [1,2,0.00000013668,1.70191859339,6279.55273164240],
  [1,3,0.00000128116,3.14159265359,0.00000000000],
  [1,3,0.00000072366,1.32019314413,12566.15169998280],
  [1,3,0.00000013847,5.37444701633,6283.07584999140],
  [1,3,0.00000005044,0.96001931081,18849.22754997420],
  [1,3,0.00000001481,0.66592602555,6438.49624942560],
  [1,3,0.00000001481,2.84101489351,6127.65545055720],
  [1,4,0.00000004187,3.14159265359,0.00000000000],
  [1,4,0.00000001931,5.89883838000,12566.15169998280],
  [2,0,0.00000279620,3.19870156017,84334.66158130829],
  [2,0,0.00000101625,5.42248110597,5507.55323866740],
  [2,1,0.00227822442,3.41372504278,6283.07584999140],
  [2,1,0.00005429282,0.00000000000,0.00000000000],
  [2,1,0.00001903183,3.37061270964,12566.15169998280],
  [2,1,0.00000023859,3.32836261978,18849.22754997420],
  [2,2,0.00009721989,5.15233725915,6283.07584999140],
  [2,2,0.00000349501,3.14159265359,0.00000000000],
  [2,2,0.00000067136,0.64403888586,12566.15169998280],
  [2,3,0.00000276077,0.59413258730,6283.07584999140],
  [2,3,0.00000025551,3.14159265359,0.00000000000],
  [2,3,0.00000001810,0.11612262117,12566.15169998280],
  [2,4,0.00000005751,2.27069090892,6283.07584999140],
  [2,4,0.00000001305,0.00000000000,0.00000000000]
]
